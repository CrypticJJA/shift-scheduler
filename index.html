<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Scheduler - Employee Management System</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Calendar, Users, Clock, AlertCircle, CheckCircle } = lucide;

        const ShiftScheduler = () => {
            const [scheduleData, setScheduleData] = useState({
                dates: [
                    { date: '02-06-2025', required: 0, assigned: [] },
                    { date: '03-06-2025', required: 0, assigned: [] },
                    { date: '04-06-2025', required: 0, assigned: [] },
                    { date: '05-06-2025', required: 0, assigned: [] },
                    { date: '06-06-2025', required: 0, assigned: [] },
                    { date: '09-06-2025', required: 0, assigned: [] },
                    { date: '10-06-2025', required: 0, assigned: [] },
                    { date: '11-06-2025', required: 0, assigned: [] },
                    { date: '12-06-2025', required: 0, assigned: [] },
                    { date: '13-06-2025', required: 0, assigned: [] },
                    { date: '16-06-2025', required: 0, assigned: [] },
                    { date: '17-06-2025', required: 0, assigned: [] },
                    { date: '18-06-2025', required: 0, assigned: [] },
                    { date: '19-06-2025', required: 0, assigned: [] },
                    { date: '20-06-2025', required: 0, assigned: [] },
                    { date: '23-06-2025', required: 0, assigned: [] },
                    { date: '24-06-2025', required: 0, assigned: [] }
                ],
                employees: [
                    { name: 'Abhiram R', group: 'A', totalShifts: 0, weekShifts: 0 },
                    { name: 'Devaganga K', group: 'A', totalShifts: 0, weekShifts: 0 },
                    { name: 'Kavya M', group: 'A', totalShifts: 0, weekShifts: 0 },
                    { name: 'Adarsh J', group: 'A', totalShifts: 0, weekShifts: 0 },
                    { name: 'Divya S', group: 'A', totalShifts: 0, weekShifts: 0 },
                    { name: 'Aleena J', group: 'A', totalShifts: 0, weekShifts: 0 },
                    { name: 'Emily E', group: 'B', totalShifts: 0, weekShifts: 0 },
                    { name: 'Sanjay G', group: 'B', totalShifts: 0, weekShifts: 0 },
                    { name: 'Jefferson A', group: 'B', totalShifts: 0, weekShifts: 0 },
                    { name: 'Jerome B', group: 'B', totalShifts: 0, weekShifts: 0 },
                    { name: 'Aswathi P', group: 'B', totalShifts: 0, weekShifts: 0 },
                    { name: 'Joseph J', group: 'B', totalShifts: 0, weekShifts: 0 },
                    { name: 'Tilmeezur R', group: 'C', totalShifts: 0, weekShifts: 0 },
                    { name: 'Justyna S', group: 'C', totalShifts: 0, weekShifts: 0 },
                    { name: 'Vishnu B', group: 'C', totalShifts: 0, weekShifts: 0 },
                    { name: 'Bony R', group: 'C', totalShifts: 0, weekShifts: 0 },
                    { name: 'Kattackakathu N', group: 'C', totalShifts: 0, weekShifts: 0 }
                ]
            });

            const [selectedDate, setSelectedDate] = useState('');
            const [selectedEmployee, setSelectedEmployee] = useState('');
            const [requiredPeople, setRequiredPeople] = useState(0);
            const [suggestedEmployees, setSuggestedEmployees] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);

            // Function to get employee suggestions for equal distribution
            const getSuggestedEmployees = (dateStr, requiredCount) => {
                const targetDate = scheduleData.dates.find(d => d.date === dateStr);
                if (!targetDate || requiredCount === 0) return [];

                // Get available employees (not already assigned to this date)
                const availableEmployees = scheduleData.employees.filter(
                    emp => !targetDate.assigned.includes(emp.name)
                );

                // Sort by total shifts (ascending) and then by name for consistency
                const sortedEmployees = availableEmployees.sort((a, b) => {
                    if (a.totalShifts !== b.totalShifts) {
                        return a.totalShifts - b.totalShifts; // Fewer shifts first
                    }
                    return a.name.localeCompare(b.name); // Alphabetical for tie-breaking
                });

                // Get the required number of employees
                return sortedEmployees.slice(0, requiredCount);
            };

            // Function to auto-assign suggested employees
            const assignSuggestedEmployees = () => {
                if (!selectedDate || suggestedEmployees.length === 0) return;

                setScheduleData(prev => {
                    const newData = { ...prev };
                    
                    // Find the date
                    const dateIndex = newData.dates.findIndex(d => d.date === selectedDate);
                    if (dateIndex === -1) return prev;

                    // Add all suggested employees to the date
                    const currentAssigned = newData.dates[dateIndex].assigned;
                    const newAssignments = suggestedEmployees
                        .filter(emp => !currentAssigned.includes(emp.name))
                        .map(emp => emp.name);

                    newData.dates[dateIndex].assigned = [...currentAssigned, ...newAssignments];

                    // Update employee shift counts
                    newAssignments.forEach(empName => {
                        const empIndex = newData.employees.findIndex(e => e.name === empName);
                        if (empIndex !== -1) {
                            newData.employees[empIndex].totalShifts += 1;
                            newData.employees[empIndex].weekShifts += 1;
                        }
                    });

                    return newData;
                });

                setSuggestedEmployees([]);
                setShowSuggestions(false);
            };

            // Update suggestions when date or requirement changes
            useEffect(() => {
                if (selectedDate && requiredPeople > 0) {
                    const targetDate = scheduleData.dates.find(d => d.date === selectedDate);
                    const remainingNeeded = requiredPeople - (targetDate?.assigned.length || 0);
                    
                    if (remainingNeeded > 0) {
                        const suggestions = getSuggestedEmployees(selectedDate, remainingNeeded);
                        setSuggestedEmployees(suggestions);
                        setShowSuggestions(suggestions.length > 0);
                    } else {
                        setSuggestedEmployees([]);
                        setShowSuggestions(false);
                    }
                } else {
                    setSuggestedEmployees([]);
                    setShowSuggestions(false);
                }
            }, [selectedDate, requiredPeople, scheduleData]);

            const assignEmployee = () => {
                if (!selectedDate || !selectedEmployee) return;

                setScheduleData(prev => {
                    const newData = { ...prev };
                    
                    // Find the date
                    const dateIndex = newData.dates.findIndex(d => d.date === selectedDate);
                    if (dateIndex === -1) return prev;

                    // Check if employee is already assigned to this date
                    if (newData.dates[dateIndex].assigned.includes(selectedEmployee)) {
                        return prev;
                    }

                    // Add employee to date
                    newData.dates[dateIndex].assigned = [...newData.dates[dateIndex].assigned, selectedEmployee];

                    // Update employee shift count
                    const empIndex = newData.employees.findIndex(e => e.name === selectedEmployee);
                    if (empIndex !== -1) {
                        newData.employees[empIndex].totalShifts += 1;
                        newData.employees[empIndex].weekShifts += 1;
                    }

                    return newData;
                });

                setSelectedEmployee('');
            };

            const removeEmployee = (date, employeeName) => {
                setScheduleData(prev => {
                    const newData = { ...prev };
                    
                    // Find the date
                    const dateIndex = newData.dates.findIndex(d => d.date === date);
                    if (dateIndex === -1) return prev;

                    // Remove employee from date
                    newData.dates[dateIndex].assigned = newData.dates[dateIndex].assigned.filter(
                        emp => emp !== employeeName
                    );

                    // Update employee shift count
                    const empIndex = newData.employees.findIndex(e => e.name === employeeName);
                    if (empIndex !== -1) {
                        newData.employees[empIndex].totalShifts = Math.max(0, newData.employees[empIndex].totalShifts - 1);
                        newData.employees[empIndex].weekShifts = Math.max(0, newData.employees[empIndex].weekShifts - 1);
                    }

                    return newData;
                });
            };

            const updateRequiredPeople = () => {
                if (!selectedDate) return;

                setScheduleData(prev => {
                    const newData = { ...prev };
                    const dateIndex = newData.dates.findIndex(d => d.date === selectedDate);
                    if (dateIndex !== -1) {
                        newData.dates[dateIndex].required = requiredPeople;
                    }
                    return newData;
                });
            };

            const getEmployeesByGroup = (group) => {
                return scheduleData.employees.filter(emp => emp.group === group);
            };

            const getDateStatus = (date) => {
                const assigned = date.assigned.length;
                const required = date.required;
                
                if (required === 0) return 'inactive';
                if (assigned === required) return 'complete';
                if (assigned < required) return 'understaffed';
                return 'overstaffed';
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'complete': return 'bg-green-100 border-green-300 text-green-800';
                    case 'understaffed': return 'bg-red-100 border-red-300 text-red-800';
                    case 'overstaffed': return 'bg-yellow-100 border-yellow-300 text-yellow-800';
                    default: return 'bg-gray-100 border-gray-300 text-gray-600';
                }
            };

            const exportData = () => {
                const dataStr = JSON.stringify(scheduleData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'shift-schedule.json';
                link.click();
            };

            const resetAllData = () => {
                if (confirm('Are you sure you want to reset all schedule data? This cannot be undone.')) {
                    setScheduleData(prev => ({
                        ...prev,
                        dates: prev.dates.map(d => ({ ...d, required: 0, assigned: [] })),
                        employees: prev.employees.map(e => ({ ...e, totalShifts: 0, weekShifts: 0 }))
                    }));
                    setSelectedDate('');
                    setSelectedEmployee('');
                    setRequiredPeople(0);
                    setSuggestedEmployees([]);
                    setShowSuggestions(false);
                }
            };

            return (
                <div className="max-w-7xl mx-auto p-6 space-y-6">
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        {/* Header */}
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
                                <Calendar className="text-blue-600" size={32} />
                                Shift Scheduling Assistant
                            </h1>
                            <div className="flex gap-2">
                                <button
                                    onClick={exportData}
                                    className="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-sm"
                                >
                                    Export Data
                                </button>
                                <button
                                    onClick={resetAllData}
                                    className="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 text-sm"
                                >
                                    Reset All
                                </button>
                            </div>
                        </div>

                        {/* Step 1: Set Requirements */}
                        <div className="bg-blue-50 rounded-lg p-4 mb-6">
                            <h2 className="text-lg font-semibold mb-4">Step 1: Set Daily Requirements</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Select Date</label>
                                    <select 
                                        value={selectedDate} 
                                        onChange={(e) => {
                                            setSelectedDate(e.target.value);
                                            const date = scheduleData.dates.find(d => d.date === e.target.value);
                                            setRequiredPeople(date ? date.required : 0);
                                        }}
                                        className="w-full p-2 border rounded-md"
                                    >
                                        <option value="">Choose Date</option>
                                        {scheduleData.dates.map(date => (
                                            <option key={date.date} value={date.date}>
                                                {date.date} (Need: {date.required}, Assigned: {date.assigned.length})
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-2">Required People</label>
                                    <input
                                        type="number"
                                        value={requiredPeople}
                                        onChange={(e) => setRequiredPeople(parseInt(e.target.value) || 0)}
                                        className="w-full p-2 border rounded-md"
                                        min="0"
                                        max="20"
                                    />
                                </div>

                                <div className="flex items-end">
                                    <button
                                        onClick={updateRequiredPeople}
                                        disabled={!selectedDate}
                                        className="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed w-full"
                                    >
                                        Set Requirement
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Step 2: Smart Assignment */}
                        <div className="bg-green-50 rounded-lg p-4 mb-6">
                            <h2 className="text-lg font-semibold mb-4">
                                Step 2: Smart Employee Assignment 
                                {selectedDate && (
                                    <span className="text-sm font-normal ml-2">
                                        ({scheduleData.dates.find(d => d.date === selectedDate)?.assigned.length || 0}/
                                        {scheduleData.dates.find(d => d.date === selectedDate)?.required || 0} assigned for {selectedDate})
                                    </span>
                                )}
                            </h2>

                            {/* Smart Suggestions */}
                            {showSuggestions && (
                                <div className="mb-4 p-4 bg-blue-100 rounded-lg border-l-4 border-blue-500">
                                    <h3 className="font-semibold text-blue-800 mb-2">ü§ñ Smart Suggestions (Equal Distribution)</h3>
                                    <p className="text-sm text-blue-700 mb-3">
                                        Based on current shift counts, here are the recommended employees for fair distribution:
                                    </p>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-2 mb-3">
                                        {suggestedEmployees.map((emp, index) => (
                                            <div key={emp.name} className="bg-white p-2 rounded border text-sm">
                                                <span className="font-medium">{index + 1}. {emp.name}</span>
                                                <span className="text-gray-600 ml-2">
                                                    (Group {emp.group}, {emp.totalShifts} shifts)
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={assignSuggestedEmployees}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm"
                                        >
                                            ‚ú® Auto-Assign All Suggested
                                        </button>
                                        <button
                                            onClick={() => setShowSuggestions(false)}
                                            className="bg-gray-400 text-white px-4 py-2 rounded-md hover:bg-gray-500 text-sm"
                                        >
                                            Hide Suggestions
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Manual Assignment */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Manual Selection (Optional)</label>
                                    <select 
                                        value={selectedEmployee} 
                                        onChange={(e) => setSelectedEmployee(e.target.value)}
                                        className="w-full p-2 border rounded-md"
                                        disabled={!selectedDate}
                                    >
                                        <option value="">Choose Employee Manually</option>
                                        {scheduleData.employees
                                            .filter(emp => !scheduleData.dates.find(d => d.date === selectedDate)?.assigned.includes(emp.name))
                                            .sort((a, b) => a.totalShifts - b.totalShifts) // Show employees with fewer shifts first
                                            .map(emp => (
                                            <option key={emp.name} value={emp.name}>
                                                {emp.name} (Group {emp.group}) - {emp.totalShifts} shifts
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div className="flex items-end">
                                    <button
                                        onClick={assignEmployee}
                                        disabled={!selectedDate || !selectedEmployee}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed w-full"
                                    >
                                        Assign Manually
                                    </button>
                                </div>
                            </div>

                            {selectedDate && (
                                <div className="mt-4 p-3 bg-white rounded border">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="font-medium">Current Status for {selectedDate}:</span>
                                        <span className={`px-2 py-1 rounded text-sm ${
                                            scheduleData.dates.find(d => d.date === selectedDate)?.assigned.length === 
                                            scheduleData.dates.find(d => d.date === selectedDate)?.required 
                                                ? 'bg-green-100 text-green-800' 
                                                : 'bg-yellow-100 text-yellow-800'
                                        }`}>
                                            {scheduleData.dates.find(d => d.date === selectedDate)?.assigned.length || 0}/
                                            {scheduleData.dates.find(d => d.date === selectedDate)?.required || 0} people
                                        </span>
                                    </div>
                                    
                                    {scheduleData.dates.find(d => d.date === selectedDate)?.required === 0 && (
                                        <div className="text-amber-600 text-sm mb-2">
                                            ‚ö†Ô∏è Set the required number of people first
                                        </div>
                                    )}
                                    
                                    {scheduleData.dates.find(d => d.date === selectedDate)?.assigned.length === 
                                    scheduleData.dates.find(d => d.date === selectedDate)?.required &&
                                    scheduleData.dates.find(d => d.date === selectedDate)?.required > 0 && (
                                        <div className="text-green-600 text-sm mb-2">
                                            ‚úÖ This day is fully staffed!
                                        </div>
                                    )}

                                    {/* Show Get Suggestions button if not showing suggestions */}
                                    {!showSuggestions && selectedDate && requiredPeople > 0 && 
                                    (scheduleData.dates.find(d => d.date === selectedDate)?.assigned.length || 0) < requiredPeople && (
                                        <button
                                            onClick={() => {
                                                const targetDate = scheduleData.dates.find(d => d.date === selectedDate);
                                                const remainingNeeded = requiredPeople - (targetDate?.assigned.length || 0);
                                                const suggestions = getSuggestedEmployees(selectedDate, remainingNeeded);
                                                setSuggestedEmployees(suggestions);
                                                setShowSuggestions(true);
                                            }}
                                            className="mt-2 bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 text-sm"
                                        >
                                            üéØ Get Smart Suggestions
                                        </button>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Schedule Overview */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Dates and Assignments */}
                            <div>
                                <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                    <Clock className="text-green-600" />
                                    Schedule Overview
                                </h2>
                                <div className="space-y-3 max-h-96 overflow-y-auto">
                                    {scheduleData.dates.map(date => {
                                        const status = getDateStatus(date);
                                        return (
                                            <div key={date.date} className={`border rounded-lg p-3 ${getStatusColor(status)}`}>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="font-medium">{date.date}</span>
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-sm">
                                                            Need: {date.required} | Assigned: {date.assigned.length}
                                                        </span>
                                                        {status === 'complete' && date.required > 0 && <CheckCircle size={16} />}
                                                        {status === 'understaffed' && date.required > 0 && <AlertCircle size={16} />}
                                                        {date.required === 0 && <span className="text-xs bg-gray-200 px-2 py-1 rounded">No requirement set</span>}
                                                    </div>
                                                </div>
                                                {date.assigned.length > 0 && (
                                                    <div className="space-y-1">
                                                        {date.assigned.map(emp => {
                                                            const employee = scheduleData.employees.find(e => e.name === emp);
                                                            return (
                                                                <div key={emp} className="flex justify-between items-center text-sm bg-white bg-opacity-50 rounded px-2 py-1">
                                                                    <span>{emp} (Group {employee?.group})</span>
                                                                    <button
                                                                        onClick={() => removeEmployee(date.date, emp)}
                                                                        className="text-red-600 hover:text-red-800 text-xs"
                                                                    >
                                                                        Remove
                                                                    </button>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Employee Summary */}
                            <div>
                                <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                    <Users className="text-purple-600" />
                                    Employee Summary
                                </h2>
                                <div className="space-y-4">
                                    {['A', 'B', 'C'].map(group => (
                                        <div key={group} className="border rounded-lg p-4">
                                            <h3 className="font-semibold mb-3 text-gray-700">Group {group}</h3>
                                            <div className="grid grid-cols-1 gap-2">
                                                {getEmployeesByGroup(group).map(emp => (
                                                    <div key={emp.name} className="flex justify-between items-center p-2 bg-gray-50 rounded">
                                                        <span className="text-sm font-medium">{emp.name}</span>
                                                        <div className="text-xs text-gray-600">
                                                            <span className="bg-blue-100 px-2 py-1 rounded mr-2">
                                                                Total: {emp.totalShifts}
                                                            </span>
                                                            <span className="bg-green-100 px-2 py-1 rounded">
                                                                Week: {emp.weekShifts}
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Summary Statistics */}
                        <div className="mt-6 bg-gray-50 rounded-lg p-4">
                            <h3 className="font-semibold mb-3">Summary Statistics</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div className="bg-white p-3 rounded">
                                    <div className="text-2xl font-bold text-blue-600">
                                        {scheduleData.dates.filter(d => getDateStatus(d) === 'complete').length}
                                    </div>
                                    <div className="text-sm text-gray-600">Fully Staffed</div>
                                </div>
                                <div className="bg-white p-3 rounded">
                                    <div className="text-2xl font-bold text-red-600">
                                        {scheduleData.dates.filter(d => getDateStatus(d) === 'understaffed').length}
                                    </div>
                                    <div className="text-sm text-gray-600">Understaffed</div>
                                </div>
                                <div className="bg-white p-3 rounded">
                                    <div className="text-2xl